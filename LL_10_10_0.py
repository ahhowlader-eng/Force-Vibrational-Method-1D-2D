import numpy as np
from math import sqrt, cos, pi

for N in range(int(ECST) + 1):
    for X in range(31, 61):
        for Y in range(4, LY + 6):

            if M[Y-1, X-1] > 0:

                VDX[Y-1, X-1] = FLX[Y-1, X-1] * cos(W * N * TAU)
                VDY[Y-1, X-1] = FLY[Y-1, X-1] * cos(W * N * TAU)
                VDZ[Y-1, X-1] = FLZ[Y-1, X-1] * cos(W * N * TAU)

                # ======================================================
                # CASE 1: mod(X,3)==2 and mod(Y,2)==1
                # ======================================================
                if (X % 3 == 2) and (Y % 2 == 1):

                    VDX[Y-1, X-1] += (
                        Kra2[Y-1, X-1] * (U011[Y, X-1] - U011[Y-1, X-1]) * 0.5
                        + Kra2[Y-2, X-1] * (U021[Y-2, X-1] - U021[Y-1, X-1]) * (-0.5)
                        + Kin2[Y-1, X-1] * (U012[Y, X-1] - U012[Y-1, X-1]) * (sqrt(3)/2)
                        + Kin2[Y-2, X-1] * (U022[Y-2, X-1] - U022[Y-1, X-1]) * (-sqrt(3)/2)
                        + Kra1[Y-1, X-1] * (U0X[Y-1, X-2] - U0X[Y-1, X-1])
                        + Kin22[Y-1, X-1] * (U0X[Y+1, X-1] - U0X[Y-1, X-1])
                        + Kin22[Y-3, X-1] * (U0X[Y-3, X-1] - U0X[Y-1, X-1])
                        + Kra31[Y-1, X+1] * (U0X[Y-1, X+1] - U0X[Y-1, X-1])
                    )

                    VDY[Y-1, X-1] += (
                        Kra2[Y-1, X-1] * (U011[Y, X-1] - U011[Y-1, X-1]) * (sqrt(3)/2)
                        + Kra2[Y-2, X-1] * (U021[Y-2, X-1] - U021[Y-1, X-1]) * (sqrt(3)/2)
                        + Kin2[Y-1, X-1] * (U012[Y, X-1] - U012[Y-1, X-1]) * (-0.5)
                        + Kin2[Y-2, X-1] * (U022[Y-2, X-1] - U022[Y-1, X-1]) * (-0.5)
                        + Kin1[Y-1, X-1] * (U0Y[Y-1, X-2] - U0Y[Y-1, X-1])
                        + Kra22[Y-1, X-1] * (U0Y[Y+1, X-1] - U0Y[Y-1, X-1])
                        + Kra22[Y-3, X-1] * (U0Y[Y-3, X-1] - U0Y[Y-1, X-1])
                        + Kin31[Y-1, X+1] * (U0Y[Y-1, X+1] - U0Y[Y-1, X-1])
                    )

                    VDZ[Y-1, X-1] += (
                        Kout2[Y-1, X-1] * (U0Z[Y, X-1] - U0Z[Y-1, X-1])
                        + Kout2[Y-2, X-1] * (U0Z[Y-2, X-1] - U0Z[Y-1, X-1])
                        + Kout1[Y-1, X-1] * (U0Z[Y-1, X-2] - U0Z[Y-1, X-1])
                        + Kout21[Y-1, X-1] * (U0Z[Y+1, X-1] - U0Z[Y-1, X-1])
                        + Kout21[Y-3, X-1] * (U0Z[Y-3, X-1] - U0Z[Y-1, X-1])
                        + Kout31[Y-1, X+1] * (U0Z[Y-1, X+1] - U0Z[Y-1, X-1])
                    )

                # ======================================================
                # CASE 2: mod(X,3)==2 and mod(Y,2)==0
                # ======================================================
                if (X % 3 == 2) and (Y % 2 == 0):

                    VDX[Y-1, X-1] += (
                        Kra2[Y-1, X-1] * (U021[Y, X-1] - U021[Y-1, X-1]) * (-0.5)
                        + Kra2[Y-2, X-1] * (U011[Y-2, X-1] - U011[Y-1, X-1]) * 0.5
                        + Kin2[Y-1, X-1] * (U022[Y, X-1] - U022[Y-1, X-1]) * (-sqrt(3)/2)
                        + Kin2[Y-2, X-1] * (U012[Y-2, X-1] - U012[Y-1, X-1]) * (sqrt(3)/2)
                        + Kra1[Y-1, X] * (U0X[Y-1, X] - U0X[Y-1, X-1])
                    )

                    VDY[Y-1, X-1] += (
                        Kra2[Y-1, X-1] * (U021[Y, X-1] - U021[Y-1, X-1]) * (sqrt(3)/2)
                        + Kra2[Y-2, X-1] * (U011[Y-2, X-1] - U011[Y-1, X-1]) * (sqrt(3)/2)
                        + Kin2[Y-1, X-1] * (U022[Y, X-1] - U022[Y-1, X-1]) * (-0.5)
                        + Kin2[Y-2, X-1] * (U012[Y-2, X-1] - U012[Y-1, X-1]) * (-0.5)
                        + Kin1[Y-1, X] * (U0Y[Y-1, X] - U0Y[Y-1, X-1])
                    )

                    VDZ[Y-1, X-1] += (
                        Kout2[Y-1, X-1] * (U0Z[Y, X-1] - U0Z[Y-1, X-1])
                        + Kout2[Y-2, X-1] * (U0Z[Y-2, X-1] - U0Z[Y-1, X-1])
                        + Kout1[Y-1, X] * (U0Z[Y-1, X] - U0Z[Y-1, X-1])
                    )
